---
- hosts: all
  remote_user: ubuntu
  become: yes
  become_method: sudo
  connection: "ssh"

  tasks:
    - import_role:
        name: configure-host
    # This role is required to be run in Ubuntu 20
    - import_role:
        name: common-dns-resolv-conf
    - import_role:
        name: add-admin-keys
      vars:
        users:
          - username: "ubuntu"
            key: files/admin.pub
    - import_role:
        name: "setup-admin-users-groups-logins"
    - import_role:
        name: "common-copy-exec-to-bin"
    - import_role:
        name: apollo-dependencies
    - import_role:
       # Need to install postgres 10 in a docker container in Ubuntu 20.04
        name: common-docker-postgres
    - import_role:
        # Need to use snapd to install certbot in Ubuntu 20.04
        name: common-certbot-snapd
    - import_role:
        name: common-nginx
    - import_role:
        name: common-open-jdk
    - import_role:
        name: common-tomcat-ubuntu20
    - import_role:
        name: apollo-copy-war-ubuntu20
    - import_role:
        name: apollo-create-apollo-data-dir
    - import_role:
        name: apollo-deploy-war
    - import_role:
        name: apollo-docker-postgres
    - import_role:
        name: common-nagios-nrpe
    - import_role:
        name: configure-ufw
    - import_role:
        name: prometheus-exporters-ubuntu20
    - import_role:
        name: prometheus-exporters-set-conf
    - import_role:
        name: apollo-restart-tomcat
    
